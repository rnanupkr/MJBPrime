<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MJB Prime Vikas Samiti - Flat Statement</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; margin:0; background:#f8f9fa; color:#222; }
    header { background:#2c3e50; padding:15px 0; text-align:center; color:white; }
    header h1 { margin:0; font-size:24px; }
    nav { background:#34495e; display:flex; justify-content:center; padding:8px 0; flex-wrap:wrap; }
    nav a { color:white; text-decoration:none; padding:8px 16px; font-weight:600; }
    nav a:hover { background:#1abc9c; color:white; border-radius:4px; }
    .container { max-width:1200px; margin:20px auto; padding:0 15px; }
    .search-box { text-align:center; margin-bottom:20px; }
    input[type="text"], select { padding:8px; margin:4px; font-size:14px; border:1px solid #ccc; border-radius:4px; }
    button { padding:8px 12px; margin:4px; font-size:14px; cursor:pointer; border:none; border-radius:4px; background:#007bff; color:white; }
    button:hover { background:#0056b3; }
    table { border-collapse: collapse; width: 100%; max-width: 100%; overflow-x: auto; display: block; background:white; }
    th, td { border:1px solid #ddd; padding:8px; text-align:center; font-size:14px; }
    th { background:#007bff; color:white; }
    tr:nth-child(even){ background:#f7f9fc; }
    tr.total-row { font-weight:700; background:#f1f1f1; }
    .msg { margin-top:12px; color:#c0392b; font-weight:600; text-align:center; }
    .info { margin-top:8px; color:#2d7a2d; font-weight:600; text-align:center; }
    .performance { margin-bottom:12px; color:#2c3e50; font-weight:700; text-align:center; font-size:16px; }
    @media (max-width: 600px) { th, td { font-size:12px; padding:4px 6px; } }
  </style>
</head>
<body>
  <header>
    <h1>MJB Prime Vikas Samiti</h1>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="flatstmnt.html">Flat Statement</a>
    <a href="rules.html">Rules & Regulations</a>
    <a href="contact.html">Contact</a>
  </nav>

  <div class="container">
    <div class="search-box">
      <label><input type="checkbox" id="flatCheck"> Search by Flat No</label>
      <label style="margin-left:20px;"><input type="checkbox" id="monthCheck"> Search by Month & Year</label>
      <br><br>
      <input id="flatNo" type="text" placeholder="e.g. 101" disabled />
      <select id="monthSelect" disabled>
        <option value="">Select Month</option>
        <option>January</option><option>February</option><option>March</option>
        <option>April</option><option>May</option><option>June</option>
        <option>July</option><option>August</option><option>September</option>
        <option>October</option><option>November</option><option>December</option>
      </select>
      <select id="yearSelect" disabled>
        <option value="">Select Year</option>
        <option>2023</option><option>2024</option><option>2025</option>
      </select>
      <button id="searchBtn" disabled>Submit</button>
    </div>

    <div id="performance" class="performance"></div>
    <div id="result"></div>
  </div>

  <script>
    let data = [];
    const JSON_URL = "https://raw.githubusercontent.com/rnanupkr/MJBPrime/main/flats.json";

    const flatCheck = document.getElementById("flatCheck");
    const monthCheck = document.getElementById("monthCheck");
    const flatNo = document.getElementById("flatNo");
    const monthSelect = document.getElementById("monthSelect");
    const yearSelect = document.getElementById("yearSelect");
    const searchBtn = document.getElementById("searchBtn");
    const resultDiv = document.getElementById("result");
    const performanceDiv = document.getElementById("performance");

    function updateInputState(clickedCheckbox){
      resultDiv.innerHTML = "";
      performanceDiv.innerHTML = "";

      if(clickedCheckbox === 'flat'){
        monthCheck.checked = false;
        flatNo.disabled = false;
        monthSelect.disabled = true;
        yearSelect.disabled = true;
        flatNo.value = "";
        monthSelect.value = "";
        yearSelect.value = "";
        searchBtn.disabled = false;
      } else if(clickedCheckbox === 'month'){
        flatCheck.checked = false;
        flatNo.disabled = true;
        monthSelect.disabled = false;
        yearSelect.disabled = false;
        flatNo.value = "";
        monthSelect.value = "";
        yearSelect.value = "";
        searchBtn.disabled = false;
      } else {
        flatNo.disabled = true;
        monthSelect.disabled = true;
        yearSelect.disabled = true;
        flatNo.value = "";
        monthSelect.value = "";
        yearSelect.value = "";
        searchBtn.disabled = true;
      }
    }

    flatCheck.addEventListener("click", () => updateInputState('flat'));
    monthCheck.addEventListener("click", () => updateInputState('month'));

    // Load JSON
    fetch(JSON_URL)
      .then(resp => { if(!resp.ok) throw new Error(resp.status); return resp.text(); })
      .then(txt => { data = JSON.parse(txt); })
      .catch(err => { resultDiv.innerHTML = "<div class='msg'>Error loading data.</div>"; console.error(err); });

    function escapeHtml(s) { return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

    function parseAmount(str){
      return Number((str||"0").replace(/[₹,]/g,''));
    }

    function searchFlat(){
      resultDiv.innerHTML = "";
      performanceDiv.innerHTML = "";

      if(!data.length){ resultDiv.innerHTML = "<div class='msg'>Data not loaded yet.</div>"; return; }

      let matches = [];
      let isMonthSearch = false;

      if(flatCheck.checked){
        const f = flatNo.value.trim();
        if(!f){ resultDiv.innerHTML = "<div class='msg'>Please enter a Flat No.</div>"; return; }
        matches = data.filter(item => (item["Flat No"]||"").trim()===f);
      } else if(monthCheck.checked){
        const m = monthSelect.value, y = yearSelect.value;
        if(!m || !y){ resultDiv.innerHTML = "<div class='msg'>Please select Month and Year.</div>"; return; }
        matches = data.filter(item => (item["Month"]||"")===m && (item["Year"]||"")===y);
        isMonthSearch = true;
      } else {
        resultDiv.innerHTML = "<div class='msg'>Please select a search criteria.</div>";
        return;
      }

      if(!matches.length){ resultDiv.innerHTML = "<div class='msg'>No record found.</div>"; return; }

      let totalBill = 0, totalReceived = 0, totalPending = 0;
      let html = `<table><thead>
        <tr>
          <th>Flat No</th><th>Name</th><th>Month</th><th>Year</th>
          <th>Bill Amount</th><th>Received Amount</th><th>Mode</th><th>Pending Amount</th><th>Remarks</th>
        </tr></thead><tbody>`;

      matches.forEach(rec => {
        const bill = parseAmount(rec["Bill Amount"]);
        const received = parseAmount(rec["Received Amount"]);
        const pending = parseAmount(rec["Pending Amount"]);
        totalBill += bill;
        totalReceived += received;
        totalPending += pending;

        html += `<tr>
          <td>${escapeHtml(rec["Flat No"]||"")}</td>
          <td>${escapeHtml(rec["Name"]||"")}</td>
          <td>${escapeHtml(rec["Month"]||"")}</td>
          <td>${escapeHtml(rec["Year"]||"")}</td>
          <td>${escapeHtml(rec["Bill Amount"]||"")}</td>
          <td>${escapeHtml(rec["Received Amount"]||"")}</td>
          <td>${escapeHtml(rec["Mode"]||"")}</td>
          <td>${escapeHtml(rec["Pending Amount"]||"")}</td>
          <td>${escapeHtml(rec["Remarks"]||"")}</td>
        </tr>`;
      });

      // Add totals row
      html += `<tr class="total-row">
        <td colspan="4">Total</td>
        <td>₹${totalBill.toLocaleString('en-IN', {minimumFractionDigits:2})}</td>
        <td>₹${totalReceived.toLocaleString('en-IN', {minimumFractionDigits:2})}</td>
        <td></td>
        <td>₹${totalPending.toLocaleString('en-IN', {minimumFractionDigits:2})}</td>
        <td></td>
      </tr>`;
      html += "</tbody></table>";
      resultDiv.innerHTML = html;

      // Show performance factor if month search
      if(isMonthSearch){
        const factor = totalBill ? ((totalReceived/totalBill)*100).toFixed(2) : "0.00";
        performanceDiv.innerHTML = `Society Performance Factor: ${factor}%`;
      }
    }

    searchBtn.addEventListener("click", searchFlat);
    flatNo.addEventListener("keydown", e => { if(e.key==="Enter") searchFlat(); });
    monthSelect.addEventListener("keydown", e => { if(e.key==="Enter") searchFlat(); });
    yearSelect.addEventListener("keydown", e => { if(e.key==="Enter") searchFlat(); });
  </script>
</body>
</html>
